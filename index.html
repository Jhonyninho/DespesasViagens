<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Despesas de Viagem</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA MANIFEST -->
  <link rel="manifest" href="manifest.json">

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- SERVICE WORKER REGISTRATION -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./service-worker.js")
          .then(() => console.log("SW registrado"))
          .catch(err => console.error("Erro ao registrar SW:", err));
      });
    }
  </script>
</head>

<body class="page">

  <!-- ========== LOGIN ========== -->
  <div id="login-screen" class="login-container">
    <div class="login-box">
      <div class="login-logo">DV</div>
      <div class="login-title">Despesas de Viagem</div>
      <div class="login-subtitle">Acesse com seu usu√°rio e senha cadastrados na aba FUNCIONARIOS.</div>

      <form class="login-form" onsubmit="event.preventDefault(); realizarLogin();">
        <input id="loginEmail" type="email" placeholder="E-mail" required />
        <input id="loginSenha" type="password" placeholder="Senha" required />
        <button class="btn" type="submit">Entrar</button>
        <div id="loginErro" class="login-error"></div>
      </form>
    </div>
  </div>

  <!-- ========== APP ========== -->
  <div id="app-screen" class="hidden">

    <!-- TOPO -->
    <header class="topbar">
      <div>
        <h2 id="tituloUsuario">Ol√°!</h2>
        <p>Resumo das suas despesas</p>
        <div id="infoTipoUsuario" class="topbar-user"></div>
        <div class="logout-link" onclick="logout()">Sair</div>
      </div>
      <div class="topbar-icon">üë§</div>
    </header>

    <!-- DASHBOARD -->
    <main id="page-dashboard" class="page-view active">

      <section class="cards-grid">
        <div class="card card-green">
          <h4>Saldo inicial</h4>
          <p class="value" id="saldoInicial">R$ 0,00</p>
        </div>
        <div class="card card-yellow">
          <h4>Total gasto</h4>
          <p class="value" id="totalGasto">R$ 0,00</p>
        </div>
        <div class="card card-balance" id="cardSaldoAtual">
          <h4>Saldo atual</h4>
          <p class="value" id="saldoAtual">R$ 0,00</p>
          <span class="tag" id="tagSaldoStatus">Dentro do limite</span>
        </div>
      </section>

      <section class="chart-section">
        <div class="section-header">
          <h4>Distribui√ß√£o dos gastos</h4>
        </div>
        <canvas id="graficoCategorias" height="180"></canvas>
      </section>

      <section class="recents">
        <div class="section-header">
          <h4>√öltimas despesas</h4>
        </div>
        <div id="ultimasDespesas" class="list"></div>
      </section>

    </main>

    <!-- NOVA DESPESA -->
    <main id="page-nova" class="page-view">
      <h2 class="subheader">Nova despesa</h2>

      <form id="formDespesa" class="form" onsubmit="event.preventDefault(); salvarDespesa();">

        <label>Categoria</label>
        <select id="categoria" required></select>

        <label>Valor (R$)</label>
        <input type="number" id="valor" step="0.01" min="0" required />

        <label>Data</label>
        <input type="date" id="data" required />

        <label>Descri√ß√£o</label>
        <input type="text" id="descricao" placeholder="Restaurante, Uber, Hotel..." required />

        <label>Comprovante (PDF/Imagem)</label>
        <input type="file" id="comprovante" accept="image/*,application/pdf" />

        <button class="btn">Salvar</button>

      </form>
    </main>

    <!-- HIST√ìRICO -->
    <main id="page-historico" class="page-view">
      <h2 class="subheader">Hist√≥rico</h2>

      <section class="filters">
        <div id="filtroGestorWrapper" class="hidden">
          <label>Filtrar funcion√°rio</label>
          <select id="filtroUsuarioGestor" onchange="aplicarFiltroGestor()">
            <option value="">Todos</option>
          </select>
        </div>

        <label>Categoria</label>
        <select id="filtroCategoria" onchange="renderHistorico()">
          <option value="">Todas</option>
        </select>
      </section>

      <section id="listaHistorico" class="list list-historico"></section>
    </main>

    <!-- EDITAR DESPESA -->
    <main id="page-editar" class="page-view">
      <h2 class="subheader">Editar despesa</h2>

      <form id="formEditar" class="form" onsubmit="event.preventDefault(); salvarEdicao();">
        <input type="hidden" id="editId" />

        <label>Categoria</label>
        <select id="editCategoria" required></select>

        <label>Valor (R$)</label>
        <input type="number" id="editValor" min="0" step="0.01" required />

        <label>Data</label>
        <input type="date" id="editData" required />

        <label>Descri√ß√£o</label>
        <input type="text" id="editDescricao" required />

        <div class="edit-actions">
          <button class="btn" type="submit">Salvar altera√ß√µes</button>
          <button type="button" class="btn-danger" onclick="confirmarExclusaoAtual()">Excluir despesa</button>
        </div>
      </form>
    </main>

    <!-- GEST√ÉO -->
    <main id="page-gestao" class="page-view">
      <h2 class="subheader">Gest√£o de Funcion√°rios</h2>

      <div class="gestao-card">
        <h3>Novo / Editar funcion√°rio</h3>

        <form class="form" onsubmit="event.preventDefault(); salvarFuncionarioGestor();">

          <label>E-mail</label>
          <input type="email" id="gestorNovoEmail" required />

          <label>Nome</label>
          <input type="text" id="gestorNovoNome" required />

          <label>Senha (deixe em branco para n√£o alterar)</label>
          <input type="password" id="gestorNovoSenha" />

          <label>Saldo atual</label>
          <input type="number" id="gestorNovoSaldo" step="0.01" />

          <label>Tipo de usu√°rio</label>
          <select id="gestorNovoTipo">
            <option value="FUNCIONARIO">Funcion√°rio</option>
            <option value="GESTOR">Gestor</option>
          </select>

          <button class="btn">Salvar funcion√°rio</button>

        </form>
      </div>

      <h3 style="margin-top: 20px; font-size: 16px;">Funcion√°rios cadastrados</h3>
      <div id="gestaoListaFuncionarios" class="gestao-grid"></div>

    </main>

    <!-- MODAL -->
    <div id="modalExcluir" class="modal hidden">
      <div class="modal-box">
        <h3>Excluir despesa?</h3>
        <p>Essa a√ß√£o n√£o pode ser desfeita.</p>
        <div class="modal-actions">
          <button class="btn-danger" onclick="excluirDespesaConfirmada()">Excluir</button>
          <button class="btn-white" onclick="fecharModal()">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- MENU -->
    <nav class="bottom-nav">
      <button id="tab-dashboard" onclick="showPage('dashboard')" class="active">
        üè†
        <span>Dashboard</span>
      </button>

      <button id="tab-nova" onclick="showPage('nova')">
        ‚ûï
        <span>Nova</span>
      </button>

      <button id="tab-historico" onclick="showPage('historico')">
        üìÑ
        <span>Hist√≥rico</span>
      </button>

      <button id="tab-gestao" class="hidden" onclick="showPage('gestao')">
        ‚öôÔ∏è
        <span>Gest√£o</span>
      </button>
    </nav>

  </div>

  <!-- APP JS -->
  <script src="app.js"></script>

</body>
</html>
